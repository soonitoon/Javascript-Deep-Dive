# 9장: 타입 변환과 단축 평가

## 9.1 타입 변환이란?

 - **명시적 타입 변환**, **타입 캐스팅**: 개발자가 명시적으로 어떤 값의 타입을 바꾸는 것.
 - **암묵적 타입 변환**, **타입 강제 변환**: 표현식 평가 과정에서 자바스크립트 엔진에 의해 암묵적으로 타입이 바뀌는 것.

```js
var x = 10;

var xString = x.toString(); // 명시적 타입 변환
var xString2 = x + ''; // 암묵적 타입 변환
```

- 암묵적 타입 변환은 다음 순서로 일어난다.
  1. `x + ''` 표현식을 평가하기 시작한다.
  2. `x` 값을 바탕으로 `'10'` 값을 새로 생성한다.
  3. `'x' + ''` 표현식을 평가하고, 평가된 값을 변수에 저장한다.
  4. 만들었던 `'x'` 값을 버린다.
- 암묵적 타입 변환이 혼란스럽다고 해서, 모든 타입 변환을 명시적으로 바꾸는 건 좋은 선택지가 아니다.
- 자바스크립트의 규칙에 익숙한 사람에게는 오히려 암묵적 타입 변환이 직관적으로 다가오기 때문.
- 따라서 암묵적 타입 변환이 언제 어떻게 일어나는지 정확히 아는 것이 중요하다.

## 9.2 암묵적 타입 변환

```js
'10' + 2; // "102"
5 * '10'; // 50
```

- 자바스크립트에서는 문맥에 맞지 않는 표현식을 평가할 때 문맥에 맞게 타입을 원시 타입 중 하나로 자동 변환한다.

### 9.2.1 문자열 타입 변환

- `+` 연산자의 피연산자 중 하나 이상이 문자열 타입이면 문자열 연결 연산자로 동작한다.
- 따라서 피연산자 중 문자열이 아닌 것이 있으면 문자열 타입으로 자동 변환한 후 표현식을 평가한다.

```js
// 숫자 타입 -> 문자열 타입
0 + ''; // "0"
-0 + ''; // "0"
-1 + ''; // "-1"
NaN + ''; // "NaN"
Infinity + ''; // "Infinity"
-Infinity + ''; // "-Infinity"

// 불리언 타입
true + ''; // "true"
false + ''; // "false"

// null 타입
null + ''; // "null"

// undefined 타입
undefined + ''; // "undefined"

// 심벌 타입
(Symbol()) + ''; // 타입 에러(문자열 변환 불가)

// 객체 타입
{} + ''; // "[object Object]"
[] + ''; // ""
[10, 20] + ''; // "10,20"
(function() {}) + ''; // "function(){}"
```

### 9.2.2 숫자 타입으로 변환

- `-`, `*`, `/` 연산자는 산술연산자로, 숫자 타입을 반환한다.
- 따라서 피연산자 중 숫자 타입이 아닌 것을 숫자 타입으로 자동 변환한다.

```js
1 - '1'; // 0
1 * '10'; // 10
1 / 'hello'; // NaN
```

- 비교 연산자 역시 숫자의 대소를 비교해야 하기 때문에 피연산자를 자동으로 숫자 타입으로 바꾼다.

```js
'1' > 2; // false
```

- `+` 단항 연산자 역시 피연산자에 대해 숫자 타입 변환을 한다.

```js
// 문자열 타입
+'' // 0
+'1' // 1
+'Hello' // NaN

// 불리언 타입
+true // 1
+false // 0

// null 타입
+null // 0

// undefined 타입
+undefined // NaN

// 심볼 타입
+Symbol() // 타입 에러

// 객체 타입
+{} // NaN
+[] // 0
+[10, 20] // NaN
+(function(){}) // NaN
```

### 9.2.3 불리언 타입으로 변환

- `if`문, 제어문, 삼항연산자의 조건식은 불리언값으로 평가되어야 한다.
- 따라서 불리언이 아닌 값으로 평가될 경우 자바스크립트 엔진은 `Truthy` 값과 `Falsy` 값으로 구분하여 해당하는 불리언 값으로 타입 변환을 수행한다.
- `Falsy`로 평가되는 값은 정해져있으며, 그 외에는 모두 `Truthy` 값으로 평가된다.
  - `false`
  - `undefined`
  - `null`
  - `0`, `-0`
  - `NaN`
  - `''`(빈 문자열열

## 9.3 명시적 타입 변환

### 9.3.1 문자열 타입 변환

- `String` 생성자 함수를 `new` 연산자 없이 호출
- `Object.prototype.toString` 메서드 호출
- 문자열 연결 연산자 사용

```js
String(1); // "1"

(1).toString(); // "1"

1 + ''; // "1"
```

### 9.3.2 숫자 타입으로 변환

- `Number` 생성자 함수를 `new` 연산자 없이 호출.
- `parseInt`, `parseFloat` 함수를 사용(문자열만 사용 가능).
- `+` 단항 연산자 사용.
- `*` 산술 연산자 사용.

```js
Number('1'); // 1

Number(true); // 1
Number(false); // 0

parseInt('0'); // 0
parseFloat('0.1'); // 0.1

+'0'; // 0
+'10.23;' // 10.23

+true; // 1
+false; // 0

'0' * 1; // 0
true * 1; // 1
```

### 9.3.3 불리언 타입으로 변환

- `Boolean` 생성자 함수를 `new` 연산자 없이 호출.
- `!` 연산자를 두 번 사용.

```js
Boolean(''); // false
Boolean('Hello'); // true
Boolean(0); // false

!!''; // false 
!!'Hello'; // true
!!0; // false
```

## 9.4 단축 평가

### 9.4.1 논리 연산자를 사용한 단축 평가

- 논리합 또는 논리곱 연산자는 언제나 2개의 피연산자 중 하나를 반환한다.
- 이때 연산자가 반환하는 피연산자는 **연산의 결과를 결정**하는 피연산자이다.

```js
'Hello' && 'World'; // "World"

/*
논리곱 연산자는 두 피연산자가 모두 Truthy일 때 우항의 피연산자를 반환한다.
'Hello'만 보고서는 표현식의 평가 결과를 알 수 없으며, 'World'도 Truthy 값인지 평가해야 하기 때문이다.
*/

'' && 'World' // ""

/*
이 경우 ''는 Falsy 값이므로 우항의 피연산자가 어떤 값이더라도 표현식은 true가 될 수 없다.
따라서 논리곱 연산자는 'World'를 평가하지 않고 바로 좌항의 ''을 반환한다.
이를 단축평가라고 한다.
*/
```

|단축 평가 표현식|평가 결과|
|-|-|
|`true \|\| anything`|`true`|
|`false \|\| anything`|`anything`|
|`true && anything`|`anything`|
|`false && anything`|`false`|

- 논리합 연산자와 논리곱 연산자는 `if`문을 대체할 수 있다.

```js
var number = 1;

if (number % 2 === 0) {
  console.log('짝수입니다.');
}

number % 2 === 0 && console.log('짝수입니다.');

number % 2 === 0 || console.log('홀수입니다.');
```

- 단축 평가는 다음의 경우에 유용하게 쓰일 수 있다.

```js
// 객체의 속성에 참조하기 전, 객체의 존재 여부를 미리 검사하기

var nullObj = null;

nullObj && nullObj.prop; // 단축 평가 덕분에 타입 오류가 발생하지 않는다.

// 함수 매개변수에 기본값을 설정할 때

function getLengthOfString(str) {
  str = str || ''; // 함수 호출 시 매개변수를 전달하지 않아도 자동으로 빈 문자열을 삽입한다.
  return str.length;
}
```

### 9.4.2 옵셔널 체이닝 연산자

- ES11부터 도입된 연산자.
- 좌항의 피연산자가 `null` 또는 `undefined`면 `undefined`를 반환하고, 아니면 참조를 이어간다.
- 기존 단축 평가 방식보다 가독성에 좋고, `Falsy` 값으로 평가되는 객체의 속성도 참조할 수 있다는 장점이 있다.

```js
var str = '';

console.log(str && str.length); // ''
// 개발자의 의도와는 다르게 빈 문자열은 Falsy 값으로 평가되므로 단축평가에 의해 0이 아닌 str이 그대로 출력된다.

console.log(str?.length); // 0
// str이 null이나 undefined만 아니라면 참조를 이어간다.
```

### 9.4.3 null 병합 연산자

- ES11부터 도입된 연산자.
- 좌항의 피연산자가 `null` 또는 `undefined`인 경우 우항의 피연산자를 반환하고, 그렇지 않으면 좌항의 피연산자를 반환한다.
- 주로 변수의 기본값을 설정할 때 유용하다.
- 기존 단축평가 방식으로는 `Falsy`로 평가되는 값을 처리할 때 혼란스럽기 때문이다.

```js
var str = '' || 'default string';

console.log(str); // "default string"
// 빈 문자열도 유효한 값일 경우, 단축 평가를 사용하면 변수에 할당할 수 없다.

var str2 = '' ?? 'default string';

console.log(str2); // ''
// 좌항의 피연산자가 null이나 undefined만 아니면 되므로 빈 문자열도 변수에 할당할 수 있다.
```